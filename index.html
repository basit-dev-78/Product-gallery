<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Website Demo Gallery | Web Berners</title>

  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;
      --card:#ffffff;

      --accent:#ff0066;
      --accentSoft: rgba(255,0,102,.10);

      --shadow: 0 10px 25px rgba(2, 6, 23, 0.08);
      --shadow2: 0 18px 55px rgba(2, 6, 23, 0.12);
      --max:1180px;
    }

    *{box-sizing:border-box}
    html,body{width:100%; max-width:100%;}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Helvetica Neue", sans-serif;
      background:var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }
    a{color:inherit; text-decoration:none}

    .container{
      max-width:var(--max);
      margin:0 auto;
      padding:18px;
      width:100%;
      min-width:0;
    }

    .bgGlow{
      position:fixed;
      inset:-140px -120px auto -120px;
      height:380px;
      pointer-events:none;
      z-index:-1;
      background:
        radial-gradient(600px 220px at 18% 18%, rgba(255,0,102,.13), transparent 60%),
        radial-gradient(520px 220px at 70% 10%, rgba(37,99,235,.08), transparent 60%);
    }

    /* =========================================
       TOP WEBSITE HEADER
       ========================================= */
    .siteHeader{
      position: sticky;
      top: 0;
      z-index: 100;
      background:#fff;
      border-bottom: 1px solid rgba(229,231,235,.9);
    }
    .siteHeaderInner{
      max-width: 1180px;
      margin: 0 auto;
      padding: 10px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      width:100%;
      min-width:0;
    }

    .brandWrap{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .brandMark{display:inline-flex; align-items:center; justify-content:center;}

    .navLinks{
      display:flex;
      align-items:center;
      gap:34px;
      font-weight:800;
      color:#0f172a;
      justify-content:center;
      flex: 1;
      min-width:0;
    }
    .navLinks a{
      font-size:14px;
      opacity:.95;
      transition:.12s ease;
      white-space:nowrap;
    }
    .navLinks a:hover{opacity:1}

    .dd{display:inline-flex; align-items:center; gap:8px;}
    .caret{
      width:10px; height:10px;
      border-right:2px solid #111827;
      border-bottom:2px solid #111827;
      transform: rotate(45deg);
      margin-top:-2px;
      opacity:.75;
    }

    .headerRight{
      min-width:0;
      display:flex;
      justify-content:flex-end;
    }
    .quoteBtn{
      background:#000;
      color:#fff;
      border:0;
      padding:10px 16px;
      border-radius:10px;
      font-weight:900;
      font-size:14px;
      cursor:pointer;
      box-shadow: 0 10px 26px rgba(2,6,23,.12);
      transition:.15s ease;
      white-space:nowrap;
    }
    .quoteBtn:hover{ transform: translateY(-1px); }

    @media (max-width: 900px){
      .navLinks{display:none;}
    }

    /* ===== SUPER COMPACT FILTER HEADER ===== */
    .filtersWrap{
      position: sticky;
      top: 58px;
      z-index: 50;
      background: rgba(255,255,255,.94);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(229,231,235,.75);
      padding: 6px 0;
    }

    .filtersTop{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      min-width:0;
    }

    .searchBox{
      flex: 1 1 420px;
      display:flex; gap:8px; align-items:center;
      border:1px solid var(--border);
      background:#fff;
      border-radius: 12px;
      padding:6px 10px;
      box-shadow: 0 10px 24px rgba(2,6,23,0.04);
      min-width:0;
      width:100%;
      max-width:100%;
    }
    .searchBox input{
      border:0; outline:0; width:100%;
      font-size:12.8px;
      min-width:0;
    }

    .controls{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      min-width:0;
      max-width:100%;
    }
    select{
      border:1px solid var(--border);
      background:#fff;
      border-radius: 12px;
      padding:6px 9px;
      font-weight:950;
      font-size:12.5px;
      outline:none;
      cursor:pointer;
      max-width:100%;
    }
    .miniBtn{
      border:1px solid var(--border);
      background:#fff;
      padding:6px 10px;
      border-radius:12px;
      font-weight:950;
      cursor:pointer;
      transition:.15s ease;
      font-size:12.5px;
      white-space:nowrap;
      max-width:100%;
    }
    .miniBtn.primary{
      background:var(--accent);
      color:#fff;
      border-color:transparent;
      box-shadow: 0 16px 28px rgba(255,0,102,.16);
    }

    .filtersBottom{
      margin-top:6px;
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-start;
      flex-wrap:wrap;
      min-width:0;
    }

    .chips{ display:flex; gap:8px; flex-wrap:wrap; min-width:0; }

    .chip{
      border:1px solid var(--border);
      background:#fff;
      color:#111827;
      padding:6px 9px;
      border-radius: 999px;
      font-size:12px;
      font-weight:950;
      cursor:pointer;
      transition:.12s ease;
      display:inline-flex;
      align-items:center;
      white-space:nowrap;
    }
    .chip.active{
      background: var(--accentSoft);
      border-color: rgba(255,0,102,.35);
      color: var(--accent);
    }
    .chip .count{
      margin-left: 7px;
      min-width: 18px;
      height: 16px;
      padding: 0 5px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 950;
      border: 1px solid var(--border);
      background: #fff;
      color: #0f172a;
    }
    .chip.active .count{
      border-color: rgba(255,0,102,.35);
      background: rgba(255,0,102,.10);
      color: var(--accent);
    }

    /* ===== GRID ===== */
    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:16px;
      padding: 16px 0 30px;
      width:100%;
      min-width:0;
    }
    .card{
      border:1px solid var(--border);
      border-radius: 20px;
      background: var(--card);
      overflow:hidden;
      transition:.15s ease;
      box-shadow: 0 12px 28px rgba(2,6,23,0.05);
      width:100%;
      min-width:0;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: var(--shadow2);
      border-color: rgba(15,23,42,.12);
    }

    /* ‚úÖ IMAGE AREA */
    .thumb{
      height: 180px;
      background: #f3f4f6;
      position:relative;
      overflow:hidden;
      width:100%;
    }
    .thumb img{
      width:100%;
      height:100%;
      display:block;
      object-fit:cover;
      object-position:center;
      transform: scale(1.01);
      transition: .25s ease;
    }
    .card:hover .thumb img{ transform: scale(1.06); }

    /* ‚úÖ FIX: badges INSIDE IMAGE at BOTTOM (left/right) */
    .thumbMeta{
      position:absolute;
      left:10px;
      right:10px;
      bottom:10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      z-index:3;
      pointer-events:none; /* clicks go to card buttons, not pills */
    }
    .badgeTag{
      pointer-events:none;
      display:inline-flex;
      padding:8px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:950;
      color:#fff;
      background: var(--accent);
      box-shadow: 0 12px 26px rgba(255,0,102,.25);
      white-space:nowrap;
    }
    .priceTag{
      pointer-events:none;
      display:inline-flex;
      padding:8px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:950;
      color:#0f172a;
      background: rgba(255,255,255,.92);
      border:1px solid rgba(229,231,235,.85);
      box-shadow: 0 10px 24px rgba(2,6,23,0.10);
      white-space:nowrap;
    }

    /* optional: subtle dark fade for readability */
    .thumbShade{
      position:absolute;
      inset:auto 0 0 0;
      height:78px;
      background: linear-gradient(to top, rgba(2,6,23,.55), rgba(2,6,23,0));
      z-index:2;
      pointer-events:none;
    }

    .content{ padding:14px; }
    .titleRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      min-width:0;
    }
    .content h3{
      margin:0;
      font-size:15.5px;
      letter-spacing:-0.01em;
      line-height:1.25;
      min-width:0;
    }
    .categoryPill{
      font-size:11px;
      font-weight:950;
      color:#0f172a;
      background:#f1f5f9;
      border:1px solid #e2e8f0;
      padding:6px 9px;
      border-radius:999px;
      white-space:nowrap;
    }
    .desc{
      margin:8px 0 10px;
      color:var(--muted);
      font-size:13px;
      line-height:1.55;
      min-height:40px;
    }

    .tagRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    .tags{ display:flex; flex-wrap:wrap; gap:8px; }
    .tag{
      font-size:12px;
      color:#334155;
      background:#f8fafc;
      border:1px solid #edf2f7;
      padding:6px 8px;
      border-radius:999px;
      font-weight:750;
    }
    .rating{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-weight:900;
      font-size:12px;
      color:#0f172a;
      padding:7px 10px;
      border-radius:999px;
      background:#fff;
      border:1px solid #eef2f7;
      white-space:nowrap;
    }

    .actions{ display:flex; gap:10px; }
    .btnSmall{
      flex:1;
      border:1px solid var(--border);
      background:#fff;
      padding:10px 12px;
      border-radius: 14px;
      font-weight:950;
      font-size:13px;
      cursor:pointer;
      transition:.15s ease;
      min-width:0;
    }
    .btnSmall.primary{
      border-color: transparent;
      background: var(--accent);
      color:#fff;
      box-shadow: 0 18px 30px rgba(255,0,102,.18);
    }

    .empty{
      border:1px dashed #cbd5e1;
      background:#f8fafc;
      border-radius: 18px;
      padding:18px;
      color:#475569;
      display:none;
      margin-top:16px;
    }

    /* =========================
       MODAL
       ========================= */
    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(2,6,23,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index: 9999;
    }
    .modal{
      width: min(1280px, 96vw);
      height: min(92vh, 920px);
      background:#fff;
      border-radius: 22px;
      overflow:hidden;
      box-shadow: 0 30px 80px rgba(2,6,23,.35);
      display:flex;
      flex-direction:column;
    }
    @media (max-width: 620px){
      .modal{
        width: min(100vw, 100vw);
        height: min(94vh, 94vh);
        border-radius: 18px;
      }
    }
    .modalHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid var(--border);
      background: rgba(255,255,255,.94);
      backdrop-filter: blur(10px);
    }
    .modalHeader b{font-size:13px}
    .modalHeader .modalActions{display:flex; gap:8px; flex-wrap:wrap}
    .modalHeader .x{
      border:1px solid var(--border);
      background:#fff;
      border-radius: 12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:950;
      font-size:12.5px;
      white-space:nowrap;
    }

    .modalBody{ position:relative; flex:1; background:#fff; }
    #modalFrame{
      width:100%;
      height:100%;
      border:0;
      background:#fff;
      display:block;
      opacity:0;
      transition: opacity .16s ease;
    }
    #modalFrame.ready{ opacity:1; }

    .modalLoader{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      background: rgba(255,255,255,.72);
      backdrop-filter: blur(6px);
      z-index: 5;
      opacity:0;
      pointer-events:none;
      transition: opacity .15s ease;
    }
    .modalLoader.show{ opacity:1; pointer-events:auto; }
    .spinner{
      width:34px;
      height:34px;
      border-radius:999px;
      border:3px solid rgba(15,23,42,.14);
      border-top-color: var(--accent);
      animation: spin .8s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }
    .loaderText{ font-size:13px; font-weight:900; color:#0f172a; }

    /* Floating WhatsApp */
    .floatWa{
      position:fixed;
      right:18px;
      bottom:18px;
      z-index: 999;
      display:flex;
      gap:10px;
      align-items:center;
      padding:12px 14px;
      border-radius: 999px;
      background: var(--accent);
      color:#fff;
      font-weight:950;
      box-shadow: 0 22px 55px rgba(255,0,102,.22);
      transition:.15s ease;
    }

    /* Footer */
    footer{
      border-top: 1px solid var(--border);
      padding: 28px 0 40px;
      background: #fff;
      margin-top: 20px;
    }
    .footerInner{
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 13px;
      font-weight: 650;
    }
    .footerLinks{display:flex; gap:14px; flex-wrap:wrap}
    .footerLinks a{color: var(--muted)}
    .footerLinks a:hover{color: var(--accent)}

    @media (max-width: 980px){
      .grid{grid-template-columns: repeat(2,1fr)}
      .filtersWrap{top: 56px;}
    }

    /* ‚úÖ MOBILE thumb no crop */
    @media (max-width: 620px){
      .container{ padding: 12px; }
      .grid{ grid-template-columns: 1fr; }

      .thumb{
        height:auto;
        aspect-ratio: 16 / 9;
        background: #ffffff;
        padding: 8px;
      }
      .thumb img{
        object-fit: contain;
        object-position: center;
        background: #ffffff;
        transform: none !important;
      }
      .card:hover .thumb img{ transform:none !important; }

      /* keep bottom pills visible even when contain */
      .thumbShade{ height:72px; }
      .thumbMeta{ left:8px; right:8px; bottom:8px; }
    }

    @media (max-width: 420px){
      .searchBox{ flex: 1 1 100%; width:100%; }
      .controls{ width:100%; justify-content:space-between; }
      .controls select, .controls .miniBtn{ flex:1 1 auto; }
    }

    @media (max-width: 680px){
      .qgrid{ grid-template-columns: 1fr !important; }
    }
  </style>
</head>

<body>
  <div class="bgGlow"></div>

  <!-- TOP HEADER -->
  <header class="siteHeader">
    <div class="siteHeaderInner">
      <a class="brandWrap" href="#">
        <span class="brandMark" aria-hidden="true">
          <img style="height:40px" src="https://www.webberners.com/assets/logo.png" alt="Web Berners">
        </span>
      </a>

      <nav class="navLinks" aria-label="Main navigation">
        <a href="#">About</a>
        <a class="dd" href="#">Solution <span class="caret"></span></a>
        <a class="dd" href="#">Case Studies <span class="caret"></span></a>
        <a href="#">Blogs</a>
      </nav>

      <div class="headerRight">
        <button class="quoteBtn" id="topGetQuote">Get Quote</button>
      </div>
    </div>
  </header>

  <!-- FILTER BAR -->
  <div class="filtersWrap" id="demos">
    <div class="container">
      <div class="filtersTop">
        <div class="searchBox">
          üîé
          <input id="searchInput" type="text" placeholder="Search demos (restaurant, salon, electrician)..." />
        </div>

        <div class="controls">
          <select id="sortSelect" title="Sort demos">
            <option value="popular">Sort: Popular</option>
            <option value="newest">Sort: Newest</option>
            <option value="az">Sort: A‚ÄìZ</option>
          </select>

          <select id="priceSelect" title="Price filter">
            <option value="all">Price: All</option>
            <option value="low">Budget</option>
            <option value="mid">Standard</option>
            <option value="high">Premium</option>
          </select>

          <button class="miniBtn" id="resetBtn" type="button">Reset</button>
          <button class="miniBtn primary" id="getQuoteBtn" type="button">Get Quote</button>
        </div>
      </div>

      <div class="filtersBottom">
        <div class="chips" id="chipBar"></div>
      </div>
    </div>
  </div>

  <div class="container">
    <div id="emptyState" class="empty">
      <b>No demos match your filters.</b>
      <div style="margin-top:6px;">Try clearing search or choose ‚ÄúAll‚Äù.</div>
    </div>

    <div class="grid" id="grid"></div>
  </div>

  <!-- Floating WhatsApp -->
  <a class="floatWa" id="floatWhatsapp" href="#" target="_blank" rel="noopener">üí¨ WhatsApp</a>

  <!-- Preview Modal -->
  <div class="modalOverlay" id="modalOverlay" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalHeader">
        <b id="modalTitle">Preview</b>
        <div class="modalActions">
          <button class="x" id="modalOpenTab">Open</button>
          <button class="x" id="modalGetSite">Get This</button>
          <button class="x" id="modalClose">Close ‚úï</button>
        </div>
      </div>

      <div class="modalBody">
        <div class="modalLoader" id="modalLoader">
          <div class="spinner"></div>
          <div class="loaderText" id="loaderText">Loading preview‚Ä¶</div>
        </div>
        <iframe id="modalFrame" src="about:blank" loading="eager"></iframe>
      </div>
    </div>
  </div>

  <!-- Quote Modal -->
  <div class="modalOverlay" id="quoteOverlay" role="dialog" aria-modal="true">
    <div class="modal" style="height:auto; max-height:78vh;">
      <div class="modalHeader">
        <b>Request a Quote</b>
        <div class="modalActions">
          <button class="x" id="quoteClose">Close ‚úï</button>
        </div>
      </div>

      <div style="padding:14px; display:grid; gap:10px;">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;" class="qgrid">
          <input id="qName" placeholder="Your Name" style="padding:12px;border:1px solid var(--border);border-radius:14px;outline:none;width:100%;font:inherit;">
          <input id="qBiz" placeholder="Business Type (e.g., Restaurant)" style="padding:12px;border:1px solid var(--border);border-radius:14px;outline:none;width:100%;font:inherit;">
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;" class="qgrid">
          <input id="qCity" placeholder="City / Country" style="padding:12px;border:1px solid var(--border);border-radius:14px;outline:none;width:100%;font:inherit;">
          <input id="qBudget" placeholder="Budget (optional)" style="padding:12px;border:1px solid var(--border);border-radius:14px;outline:none;width:100%;font:inherit;">
        </div>
        <textarea id="qMsg" rows="4" placeholder="Message (pages, booking, shop, etc.)"
          style="padding:12px;border:1px solid var(--border);border-radius:14px;outline:none;width:100%;font:inherit;resize:vertical;"></textarea>

        <button class="miniBtn primary" style="padding:10px 12px;border-radius:14px;" id="sendQuoteBtn">Send on WhatsApp</button>
        <div style="color:var(--muted); font-size:12px; line-height:1.5;">
          This will open WhatsApp with your message.
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="footerInner">
      <div>¬© <span id="year"></span> Web Berners. All rights reserved.</div>
      <div class="footerLinks">
        <a href="#demos">Demos</a>
        <a href="#">Support</a>
        <a href="#" id="footerQuote">Get Quote</a>
      </div>
    </div>
  </footer>

<script>
const JSON_URL = "./demos.json";

const WHATSAPP_NUMBER = "923000000000"; // replace with your number (no +)
const BRAND_NAME = "Web Berners";

document.getElementById("year").textContent = new Date().getFullYear();
const floatWhatsapp = document.getElementById("floatWhatsapp");
floatWhatsapp.href = waLinkText(`Hi ${BRAND_NAME}, I want a website. Please share packages & timeline.`);

// Quote modal wiring
const quoteOverlay = document.getElementById("quoteOverlay");
const getQuoteBtn = document.getElementById("getQuoteBtn");
const topGetQuote = document.getElementById("topGetQuote");
const footerQuote = document.getElementById("footerQuote");
const quoteClose = document.getElementById("quoteClose");
const sendQuoteBtn = document.getElementById("sendQuoteBtn");

function openQuote(){ quoteOverlay.style.display = "flex"; }
function closeQuote(){ quoteOverlay.style.display = "none"; }

getQuoteBtn.addEventListener("click", openQuote);
topGetQuote.addEventListener("click", openQuote);
footerQuote.addEventListener("click", (e)=>{ e.preventDefault(); openQuote(); });
quoteClose.addEventListener("click", closeQuote);
quoteOverlay.addEventListener("click", (e)=>{ if(e.target === quoteOverlay) closeQuote(); });

sendQuoteBtn.addEventListener("click", () => {
  const name = (document.getElementById("qName").value || "").trim() || "Customer";
  const biz  = (document.getElementById("qBiz").value || "").trim() || "Business";
  const city = (document.getElementById("qCity").value || "").trim() || "City";
  const bud  = (document.getElementById("qBudget").value || "").trim() || "";
  const msg  = (document.getElementById("qMsg").value || "").trim() || "";

  const text =
`Hi ${BRAND_NAME}, I want a website quote.

Name: ${name}
Business: ${biz}
City/Country: ${city}
Budget: ${bud}

Requirements:
${msg}`;

  window.open(waLinkText(text), "_blank");
});

function waLinkText(text){
  return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;
}
function waLinkForDemo(item){
  const msg = `Hi ${BRAND_NAME}, I want this website demo: ${item.id} - ${item.title}. Category: ${item.category}. Please share price & delivery time.`;
  return waLinkText(msg);
}

// State
const state = { activeCategory:"All", search:"", sort:"popular", price:"all" };

const grid = document.getElementById("grid");
const chipBar = document.getElementById("chipBar");
const searchInput = document.getElementById("searchInput");
const sortSelect = document.getElementById("sortSelect");
const priceSelect = document.getElementById("priceSelect");
const emptyState = document.getElementById("emptyState");
const resetBtn = document.getElementById("resetBtn");

// Preview Modal
const modalOverlay = document.getElementById("modalOverlay");
const modalFrame = document.getElementById("modalFrame");
const modalTitle = document.getElementById("modalTitle");
const modalClose = document.getElementById("modalClose");
const modalOpenTab = document.getElementById("modalOpenTab");
const modalGetSite = document.getElementById("modalGetSite");

// Loader refs
const modalLoader = document.getElementById("modalLoader");
const loaderText = document.getElementById("loaderText");

let DEMOS = [];
let currentPreviewUrl = "";
let slowHintTimer = null;

function showLoader(text="Loading preview‚Ä¶"){
  loaderText.textContent = text;
  modalLoader.classList.add("show");
  clearTimeout(slowHintTimer);
  slowHintTimer = setTimeout(() => {
    if (modalOverlay.style.display === "flex" && !modalFrame.classList.contains("ready")) {
      loaderText.textContent = "Still loading‚Ä¶ (Try Open button)";
    }
  }, 3500);
}
function hideLoader(){
  modalLoader.classList.remove("show");
  clearTimeout(slowHintTimer);
}

function openPreview(item){
  currentPreviewUrl = item.previewUrl;
  modalTitle.textContent = `Preview: ${item.title} (${item.id})`;

  modalFrame.classList.remove("ready");
  showLoader("Loading preview‚Ä¶");

  modalOverlay.style.display = "flex";
  modalFrame.src = item.previewUrl;

  modalOpenTab.onclick = () => window.open(item.previewUrl, "_blank");
  modalGetSite.onclick = () => window.open(waLinkForDemo(item), "_blank");
}
function closePreview(){
  modalOverlay.style.display = "none";
  currentPreviewUrl = "";
  modalFrame.src = "about:blank";
  modalFrame.classList.remove("ready");
  hideLoader();
  loaderText.textContent = "Loading preview‚Ä¶";
}
modalClose.addEventListener("click", closePreview);
modalOverlay.addEventListener("click", (e)=>{ if(e.target===modalOverlay) closePreview(); });

modalFrame.addEventListener("load", () => {
  if (modalOverlay.style.display !== "flex") return;
  const src = modalFrame.getAttribute("src") || "";
  if (!src || src === "about:blank") return;
  if (src !== currentPreviewUrl) return;

  requestAnimationFrame(() => {
    modalFrame.classList.add("ready");
    requestAnimationFrame(() => hideLoader());
  });
});

window.addEventListener("keydown", (e)=>{
  if(e.key==="Escape"){ closePreview(); closeQuote(); }
});

(async function init(){
  try{
    const res = await fetch(JSON_URL, { cache: "no-store" });
    if(!res.ok) throw new Error("JSON fetch failed: " + res.status);
    const data = await res.json();
    DEMOS = normalizeJsonToDemos(data);
  }catch(err){
    console.error("Failed to load JSON:", err);
    DEMOS = [];
  }
  renderChips();
  renderGrid();
})();

function normalizeJsonToDemos(json){
  const list = Array.isArray(json) ? json : (json && Array.isArray(json.demos) ? json.demos : []);
  return list.map(item => ({
    id: item.id || ("WB-" + Math.random().toString(16).slice(2,6).toUpperCase()),
    title: item.title || "Untitled Demo",
    category: item.category || "Other",
    description: item.description || "",
    tags: Array.isArray(item.tags) ? item.tags : autoTags(item.category || "Other"),
    badge: item.badge || badgeFrom(item.popularScore || 0),   // ‚úÖ "Popular"
    priceBucket: item.priceBucket || "mid",
    priceLabel: item.priceLabel || "From ¬£149",               // ‚úÖ "From ¬£149" (fallback)
    rating: typeof item.rating === "number" ? item.rating : null,
    popularScore: typeof item.popularScore === "number" ? item.popularScore : 0,
    createdAt: item.createdAt || new Date().toISOString().slice(0,10),
    previewUrl: item.previewUrl || "about:blank",
    image: item.image || "https://images.unsplash.com/photo-1522542550221-31fd19575a2d?auto=format&fit=crop&w=1400&q=70"
  }));
}

function normalize(s){ return (s||"").toLowerCase().trim(); }

function autoTags(category){
  const base = ["Mobile","Fast"];
  if(category === "Restaurant") base.push("Menu","Booking");
  if(category === "Salon") base.push("Gallery","Appointment");
  if(category === "Electrician") base.push("Quote","Trust");
  if(category === "Clinic") base.push("SEO Ready","Appointment");
  if(category === "Gym") base.push("Pricing","CTA");
  if(category === "E-commerce") base.push("Shop","Products");
  if(category === "Real Estate") base.push("Listings","Gallery");
  if(category === "One-page") base.push("One Page","Quick Launch");
  return base;
}

function badgeFrom(score){
  if(score >= 90) return "Popular";
  if(score >= 85) return "Hot";
  if(score >= 80) return "New";
  return "Standard";
}

function categoryCounts(){
  const counts = {};
  for(const d of DEMOS) counts[d.category] = (counts[d.category]||0) + 1;
  counts["All"] = DEMOS.length;
  return counts;
}
function uniqCategories(){
  const cats = Array.from(new Set(DEMOS.map(i => i.category))).sort();
  return ["All", ...cats];
}

function renderChips(){
  const counts = categoryCounts();
  const categories = uniqCategories();

  chipBar.innerHTML = categories.map(cat => {
    const c = counts[cat] || 0;
    return `
      <button class="chip ${state.activeCategory===cat ? "active":""}" data-cat="${cat}">
        <span>${cat}</span><span class="count">${c}</span>
      </button>
    `;
  }).join("");

  chipBar.querySelectorAll(".chip").forEach(btn => {
    btn.addEventListener("click", () => {
      state.activeCategory = btn.dataset.cat;
      renderChips();
      renderGrid();
    });
  });
}

function matchesSearch(item, query){
  if(!query) return true;
  const q = normalize(query);
  const hay = [item.title,item.category,item.description,...(item.tags||[])].map(normalize).join(" ");
  return hay.includes(q);
}
function matchesPrice(item){
  if(state.price==="all") return true;
  return (item.priceBucket||"mid") === state.price;
}
function filterItems(){
  return DEMOS.filter(item => {
    const catOk = (state.activeCategory==="All") || (item.category===state.activeCategory);
    return catOk && matchesSearch(item,state.search) && matchesPrice(item);
  });
}
function sortItems(items){
  const arr = [...items];
  if(state.sort==="popular") arr.sort((a,b)=>(b.popularScore||0)-(a.popularScore||0));
  if(state.sort==="newest")  arr.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
  if(state.sort==="az")      arr.sort((a,b)=>a.title.localeCompare(b.title));
  return arr;
}

function cardHTML(item){
  const tags = (item.tags||[]).slice(0,6).map(t=>`<span class="tag">${t}</span>`).join("");
  const rating = (typeof item.rating === "number") ? `<span class="rating">‚≠ê ${item.rating.toFixed(1)}</span>` : "";
  const price = item.priceLabel || "";

  return `
    <div class="card">
      <div class="thumb">
        <img src="${item.image}" alt="${item.title}" loading="lazy"/>
        <div class="thumbShade"></div>
        <div class="thumbMeta">
          <span class="badgeTag">${item.badge}</span>
          ${price ? `<span class="priceTag">${price}</span>` : ``}
        </div>
      </div>

      <div class="content">
        <div class="titleRow">
          <h3>${item.title}</h3>
          <span class="categoryPill">${item.category}</span>
        </div>
        <div class="desc">${item.description}</div>

        <div class="tagRow">
          <div class="tags">${tags}</div>
          ${rating}
        </div>

        <div class="actions">
          <button class="btnSmall" data-preview="${item.id}">Preview</button>
          <button class="btnSmall primary" data-get="${item.id}">Get This Website</button>
        </div>
      </div>
    </div>
  `;
}

function renderGrid(){
  const sorted = sortItems(filterItems());
  if(sorted.length===0){
    emptyState.style.display="block";
    grid.innerHTML="";
    return;
  }
  emptyState.style.display="none";
  grid.innerHTML = sorted.map(cardHTML).join("");

  grid.querySelectorAll("[data-preview]").forEach(btn=>{
    const id = btn.getAttribute("data-preview");
    btn.addEventListener("click", ()=>{
      const item = DEMOS.find(d=>d.id===id);
      if(item) openPreview(item);
    });
  });

  grid.querySelectorAll("[data-get]").forEach(btn=>{
    const id = btn.getAttribute("data-get");
    btn.addEventListener("click", ()=>{
      const item = DEMOS.find(d=>d.id===id);
      if(item) window.open(waLinkForDemo(item), "_blank");
    });
  });
}

searchInput.addEventListener("input",(e)=>{ state.search=e.target.value; renderGrid(); });
sortSelect.addEventListener("change",(e)=>{ state.sort=e.target.value; renderGrid(); });
priceSelect.addEventListener("change",(e)=>{ state.price=e.target.value; renderGrid(); });

resetBtn.addEventListener("click",()=>{
  state.activeCategory="All";
  state.search="";
  state.sort="popular";
  state.price="all";
  searchInput.value="";
  sortSelect.value="popular";
  priceSelect.value="all";
  renderChips();
  renderGrid();
});
</script>
</body>
</html>
